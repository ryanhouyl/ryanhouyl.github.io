<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Java I/O流(下) | 0x80x17</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 7.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Java I/O流(下)</h1><a id="logo" href="/.">0x80x17</a><p class="description">hello, world:)</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Java I/O流(下)</h1><div class="post-meta">2021-09-20</div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">什么是装饰者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java-%E5%AD%97%E8%8A%82%E6%B5%81"><span class="toc-text">Java 字节流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java-%E5%AD%97%E7%AC%A6%E6%B5%81"><span class="toc-text">Java 字符流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">序列化与反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB"><span class="toc-text">推荐阅读</span></a></li></ol></li></ol></div></div><div class="post-content"><p>在介绍具体的 I&#x2F;O 类前，有必要先了解一下<strong>装饰者模式</strong> ，因为 <code>java.io</code> 包内的类实在有点多，如果了解装饰者模式的话，再看各种 I&#x2F;O 流类会清晰很多</p>
<h2 id="什么是装饰者模式"><a href="#什么是装饰者模式" class="headerlink" title="什么是装饰者模式"></a>什么是装饰者模式</h2><span id="more"></span>
<blockquote>
<p>装饰者模式动态的将“责任”(也就是增强的功能)附加到对象上，若要实现动态扩展功能，装饰者提供了比继承更有弹性的替代方案</p>
</blockquote>
<p>总结几个要点：</p>
<ul>
<li>装饰者和被装饰者是一样的类型，也就是有共同的超类；在这里使用继承来达到<strong>类型匹配</strong>的功能，而不是通过继承获得<strong>行为</strong></li>
<li>继承属于扩展类的一种形式，但是不利于弹性设计；在装饰者模式中，我们通过<strong>组合和委托，可以在运行时动态的添加新行为。组合优于实现继承</strong></li>
<li>可以用一个或多个装饰者包装一个对象，可以通过构造器来实现包装（在使用 Java I&#x2F;O 流类时，你是不是对一长串的 <code>new</code> 记忆犹新呢？）或者提供set方法动态注入被装饰的对象</li>
<li><strong>符合开闭原则</strong>：类应该对扩展开放,对修改关闭 </li>
<li>装饰者模式的优点在于提供了功能上的弹性扩展，但是使用不当会导致出现很多小对象，让程序变的复杂</li>
</ul>
<p>举例说明：</p>
<p>Java I&#x2F;O 类中的装饰者模式的部分类关系图如下：</p>
<p><img src="http://0x80x17.tech/img/IO_1.png"></p>
<p>在这个图中，我们最熟悉的 <code>InpusStream</code> 就是抽象组件，也就是上面说的装饰者和被装饰者共同的超类；<code>FilterInputStream</code> 是一个抽象的装饰者类；<code>FilterInputStream</code> 下面的 <code>BufferedInputStream</code>,<code>DataInputStream</code> 等类是具体的装饰者类；<code>FileInputStream</code>，<code>StringBufferInputStream</code> 等类是可以被装饰者类包装起来的具体的被装饰类。有了这样一个概念，再看这行代码 <code>BufferedInputStream bis = new BufferedInputStream(new FileInputStream(&quot;test.txt&quot;));</code> 是不是亲切多了？</p>
<p>铺垫到这里，再开始 I&#x2F;O 类的说明就简单多了，两个点：认识常见的各种 I&#x2F;O 类；熟悉常用的 API；三个字：读文档</p>
<h2 id="Java-字节流"><a href="#Java-字节流" class="headerlink" title="Java 字节流"></a>Java 字节流</h2><p>抽象基类：<code>InputStream/OutputStream</code>：InputStream  抽象了应用程序读取数据的方式，OutputStream 抽象了应用程序写出数据的方式</p>
<p>一些常用的具体类(<strong>后缀名均为 InputStream&#x2F;OutputStream</strong>)：</p>
<ul>
<li><code>FileInputStream/FileOutputStream</code>：实现了通过文件系统读写数据</li>
<li><code>DataInputStream/DataOutputStream</code>：对字节流操作的增强，可以可以更加方便的读写 <code>int</code>，<code>long</code>，<code>double</code> 等类型的数据，继承自 <code>FilterInputStream/FilterOutputStream</code> 作为装饰者。多说一句，像读取 int 等基本数据类型这种包装并不神秘，一个一个字节的读取，然后通过位操作进行组装就可以了</li>
<li><code>BufferedInputStream/BufferedOutputStream</code>：也是装饰者实现，为 I&#x2F;O 流增加了缓冲区的操作，提高了 I&#x2F;O 操作的性能；其他类不具体展开，参见官方文档</li>
</ul>
<h2 id="Java-字符流"><a href="#Java-字符流" class="headerlink" title="Java 字符流"></a>Java 字符流</h2><p>抽象基类：<code>Reader/Writer</code>。一些常用的具体类(<strong>后缀名均为 Reader&#x2F;Writer</strong>)：</p>
<ul>
<li><code>InputStreamReader/OutputStreamWriter</code>：完成字节流到字符流的转换，可以设置编码方式</li>
<li><code>FileReader/FileWriter</code>：继承自上面的两个类，创建更方便，但是不能指定编码方式</li>
<li><code>BufferedReader/BufferedWriter</code>：通过缓存字符流提高性能</li>
</ul>
<p>通过一个例子来看一下具体的 I&#x2F;O 流操作，代码实现功能为：把 a 地址处的文本文件复制到 b 地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;a&quot;</span>)));</span><br><span class="line"><span class="type">BufferedWriter</span> <span class="variable">bw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;b&quot;</span>)));</span><br><span class="line"></span><br><span class="line">String line;</span><br><span class="line"><span class="keyword">while</span> ((line = br.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">    bw.write(line);</span><br><span class="line">    bw.newLine();</span><br><span class="line">    bw.flush();</span><br><span class="line">&#125;</span><br><span class="line">br.close();</span><br><span class="line">bw.close();</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<h2 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a>序列化与反序列化</h2><p>这是一个重要的知识点，可以展开为一篇文章，这里只简单概述下</p>
<p>虚拟机内存中的对象在变为“垃圾”后，会被垃圾回收机制回收，因此当我们需要持久化对象的信息，以便在需要的时候再读取这个对象时，需要使用到序列化与反序列化的知识</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>广义上来说，把数据从一种格式转为另一种格式，都可以称作序列化。在 Java 应用的语境下，对象的序列化是指将对象转为字节序列(可用于存储或者在网络中传输)；反序列化反之</p>
<p>注：由于 Java 自带的序列化反序列化机制存在诸多问题，比如不能跨语言使用，性能不够好，序列化的数据占用空间比较大，存在安全问题等，在实际的RPC等应用中一般都不使用自带的序列化功能，可以考虑使用如 <code>Hessian, Protobuf</code> 等序列化框架。但是这并不代表原生的序列化机制一无是处，比如在不跨进程等轻量级的使用场景下，自带的序列化功能完全够用，不需要再引入额外的依赖</p>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ul>
<li>一个对象想实现序列化，该对象所在的类必须实现 <code>Serializble</code> 标记接口</li>
<li>一个类实现了序列化接口，其子类均可以序列化</li>
<li>类的静态变量不会参与序列化(序列化是针对具体对象，而静态变量属于类层面的属性)</li>
<li>基本实现类： 序列化流 <code>ObjectOutputStream</code> 和反序列化流 <code>ObjectInputStream</code></li>
<li>重写 writeObject(ObjectOutputStream out) 和 readObject(ObjectInputStream in) 方法可以实现自定义操作，比如可以对一些敏感字段实现加密</li>
<li>transient 关键字修饰的成员变量不会参与 JVM 默认的序列化和反序列化的操作（在 ArrayList 中，把 elementData 数组声明为 transient，在自定义的序列化方法 writeObject 中，只把数组的有效元素进行序列化，可以减少不必要的操作）</li>
<li>序列化 ID 的使用。没有特殊情况，建议定义为 <code>private static final long serialVersionUID = 1L;</code>，避免反序列化时因为ID值不一致导致失败</li>
</ul>
<h3 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h3><ul>
<li><a target="_blank" rel="noopener" href="http://www.cnblogs.com/archimedes/p/java-study-note16.html">java学习笔记16-I&#x2F;O流和文件</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cnblogs.com/rollenholt/articles/2180119.html">Java序列化的高级认识</a></li>
</ul>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>本文标题：</span>Java I/O流(下)</p><p><span>文章作者：</span>Ryan</p><p><span>原始链接：</span><a href="/2021/09/20/Java-I-O流-下/">https://0x80x17.tech/2021/09/20/Java-I-O%E6%B5%81-%E4%B8%8B/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://0x80x17.tech/2021/09/20/Java-I-O%E6%B5%81-%E4%B8%8B/"></i></span></p><p><span>版权声明：</span>转载或引用请注明本文链接🔗</p></div><br><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1/" rel="tag">设计</a></li></ul></div><div class="post-nav"><a class="pre" href="/2021/10/03/Java-%E6%9E%9A%E4%B8%BE%E7%B1%BB/">Java 枚举类</a><a class="next" href="/2021/09/12/Java-I-O%E6%B5%81-%E4%B8%8A/">Java I/O流(上)</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://0x80x17.tech"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img class="nofancybox" src="/img/avatar.png"/></a><p>A Lean Coder.</p></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/%E8%AE%BE%E8%AE%A1/" style="font-size: 15px;">设计</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/11/23/Java-Checked-Unchecked-Exception/">Java Checked&Unchecked Exception</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/11/11/Java-%E6%B3%9B%E5%9E%8B%E4%B8%8E%E9%80%9A%E9%85%8D%E7%AC%A6/">Java 泛型与通配符</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/29/%E7%AE%80%E8%B0%88-Java%E6%B3%9B%E5%9E%8B/">简谈 Java泛型</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/18/Java-%E5%8F%8D%E5%B0%84%E6%A6%82%E8%BF%B0/">Java 反射概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/07/Java-%E5%B5%8C%E5%A5%97%E7%B1%BB%E7%9A%84%E4%BD%BF%E7%94%A8/">Java 嵌套类的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/03/Java-%E6%9E%9A%E4%B8%BE%E7%B1%BB/">Java 枚举类</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/20/Java-I-O%E6%B5%81-%E4%B8%8B/">Java I/O流(下)</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/12/Java-I-O%E6%B5%81-%E4%B8%8A/">Java I/O流(上)</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">0x80x17.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>